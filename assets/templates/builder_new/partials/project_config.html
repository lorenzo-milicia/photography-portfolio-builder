{{define "projectConfig"}}
<div class="project-config">
  <div class="project-header">
    <h2>{{.Project.Title}}</h2>
    <a href="/layout/{{.Project.Slug}}" class="btn btn-primary">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      Edit Layout
    </a>
  </div>

  <form id="project-form" class="project-form" hx-post="/projects/{{.Project.Slug}}" hx-swap="none" hx-indicator=".project-save-indicator">
    <div class="config-section">
      <h3 class="config-section-title">Project Details</h3>
      
      <div class="config-fields">
        <div class="config-field">
          <label for="title">Title</label>
          <input type="text" id="title" name="title" value="{{.Project.Title}}" required>
        </div>

        <div class="config-field">
          <label for="description">Description</label>
          <textarea id="description" name="description" rows="3">{{.Project.Description}}</textarea>
        </div>

        <div class="config-field">
          <label class="field-inline">
            <input type="checkbox" id="hidden" name="hidden" {{if .Project.Hidden}}checked{{end}}>
            Hidden / Draft (do not generate)
          </label>
        </div>

        <div class="config-field">
          <label>Slug</label>
          <input type="text" value="{{.Project.Slug}}" disabled>
          <small class="field-hint">The slug cannot be changed after creation</small>
        </div>
      </div>
    </div>

    <div class="config-actions-inline">
      <button type="submit" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Save Project
      </button>
      <div class="spinner small project-save-indicator"></div>
    </div>
  </form>

  <!-- Photos Section (outside of project form to prevent form nesting) -->
  <div class="config-section">
    <div class="photos-header">
      <h3 class="config-section-title">Photos</h3>
      <button type="button" class="btn-collapse" data-toggle="photos-section" aria-expanded="false" aria-label="Toggle photos section">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
        <span class="photos-count">{{len .Photos}} photo{{if ne (len .Photos) 1}}s{{end}}</span>
      </button>
    </div>

    <div class="photos-section" data-section="photos-section" style="display: none;">
      {{if .Photos}}
        <div class="photo-grid" id="photo-grid">
          {{range .Photos}}
            {{template "photoItemContent" (dict "Photo" . "ProjectSlug" $.Project.Slug)}}
          {{end}}
        </div>
      {{else}}
        <div class="config-empty">
          No photos found. Upload a photo or place photos in <code>content/photos/{{.Project.Slug}}/</code>
        </div>
      {{end}}
      
      <!-- Upload Form -->
      <div class="upload-section">
        <h4>Upload Photo</h4>
        <form id="upload-form" 
              hx-post="/projects/{{.Project.Slug}}/photos/upload" 
              hx-encoding="multipart/form-data"
              hx-indicator=".upload-btn"
              hx-swap="none">
          <div class="upload-field">
            <input type="file" 
                   id="photo-file" 
                   name="photo" 
                   accept="image/jpeg,image/jpg,image/png,image/webp"
                   required>
            <button type="submit" class="btn btn-secondary upload-btn">
              <span class="btn-content">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Upload
              </span>
              <span class="btn-loading">
                <svg class="spinner-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="2" x2="12" y2="6"></line>
                  <line x1="12" y1="18" x2="12" y2="22"></line>
                  <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                  <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                  <line x1="2" y1="12" x2="6" y2="12"></line>
                  <line x1="18" y1="12" x2="22" y2="12"></line>
                  <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                  <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
                </svg>
                Uploading
              </span>
            </button>
          </div>
          <small class="field-hint">Supported formats: JPG, PNG, WebP. Image will be automatically processed into responsive variants.</small>
        </form>
      </div>
    </div>
  </div>

  <div class="project-actions">
    <form method="post" action="/projects/{{.Project.Slug}}/delete" hx-delete="/projects/{{.Project.Slug}}" hx-target="#content" hx-indicator=".main-htmx-indicator">
      <button type="submit" class="btn btn-danger">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
        Delete Project
      </button>
    </form>
  </div>
</div>
{{end}}

{{define "photoItemContent"}}
<div class="photo-item" data-hash-id="{{.Photo.HashID}}" title="{{.Photo.Filename}}">
  <button type="button" 
          class="photo-delete-btn" 
          hx-delete="/projects/{{.ProjectSlug}}/photos/{{.Photo.HashID}}" 
          hx-confirm="Delete this photo? This will remove all variants and cannot be undone."
          hx-target="closest .photo-item"
          hx-swap="outerHTML swap:0.3s"
          aria-label="Delete photo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="3 6 5 6 21 6"></polyline>
      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      <line x1="10" y1="11" x2="10" y2="17"></line>
      <line x1="14" y1="11" x2="14" y2="17"></line>
    </svg>
  </button>
  <img src="{{.Photo.ThumbPath}}" alt="{{.Photo.Filename}}" loading="lazy">
  <div class="photo-info">
    <span class="photo-name">{{.Photo.Filename}}</span>
    <span class="photo-ratio">{{.Photo.RatioWidth}}:{{.Photo.RatioHeight}}</span>
  </div>
</div>
{{end}}

{{define "photoItem"}}
<div class="photo-item" data-hash-id="{{.HashID}}" title="{{.Filename}}">
  <button type="button" 
          class="photo-delete-btn" 
          hx-delete="/projects/{{.ProjectSlug}}/photos/{{.HashID}}" 
          hx-confirm="Delete this photo? This will remove all variants and cannot be undone."
          hx-target="closest .photo-item"
          hx-swap="outerHTML swap:0.3s"
          aria-label="Delete photo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="3 6 5 6 21 6"></polyline>
      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      <line x1="10" y1="11" x2="10" y2="17"></line>
      <line x1="14" y1="11" x2="14" y2="17"></line>
    </svg>
  </button>
  <img src="{{.ThumbPath}}" alt="{{.Filename}}" loading="lazy">
  <div class="photo-info">
    <span class="photo-name">{{.Filename}}</span>
    <span class="photo-ratio">{{.RatioWidth}}:{{.RatioHeight}}</span>
  </div>
</div>
{{end}}
